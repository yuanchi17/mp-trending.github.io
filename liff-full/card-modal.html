<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>寫寫小卡</title><meta content="寫寫小卡" name="description"><meta content="寫寫小卡" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="微程式資訊 創新前瞻計畫室" property="og:site_name"><meta content="寫寫小卡" property="og:title"><meta content="website" property="og:type"><link href="https://unpkg.com/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://unpkg.com/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}</style><meta content="600" property="og:image:height"><meta content="1200" property="og:image:width"><meta content="https://i.imgur.com/jZdoYSj.png" property="og:image"><meta content="https://liff.line.me/1656762228-vABR1z2J/card-modal.html" property="og:url"><style>[v-cloak]{display:none}body{background:fixed #e7fef8 center bottom no-repeat;background-image:url(https://i.imgur.com/wAmC1XD.png)}.card{border:1px solid #abfecc;box-shadow:0 2px 3px rgba(40,70,20,.15)}.card-img{aspect-ratio:1/1;background:no-repeat center/100%;height:0;overflow:hidden;padding-bottom:100%}.btn-img{border:1px solid #ddd;position:relative}.btn-img i.fa{color:#00894a;position:absolute;right:0;top:0}.btn:focus{border:1px solid #ddd;box-shadow:none}.btn.selected{border:solid 3px #00894a;box-shadow:none}</style></head><body><script src="https://www.googletagmanager.com/gtag/js?id=G-SYT6P9ENET" async></script><script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],window.GA_MEASUREMENT_ID="G-SYT6P9ENET",gtag("js",new Date),gtag("config",window.GA_MEASUREMENT_ID,{send_page_view:!1}),(async()=>{let e=100;for(;e--&&(!window.liff||!window.liff.getVersion);)await(i=>new Promise(e=>{setTimeout(e,i)}))(100);const i=window.liff;gtag("set","user_properties",{liffVersion:i.getVersion(),...i.isInClient()?{lineVersion:i.getLineVersion()}:{}})})();</script><div class="container my-4 text-monospace" id="app" style="max-width:562.5px" v-cloak><div class="activity-item" v-if="page === 'init'"><h3 class="text-center">{{item.card_title}}</h3><img :key="'img-mission'" :src="item.cover_image" class="w-100 mb-2"><template v-if="toggle.status"><div class="card"><div class="card-body"><h5 class="text-center font-weight-bold">{{item.choose_image_text}}</h5><div class="mb-3" id="card"><div class="mx-n1 row" :key="`row-${cId}`" v-for="(chunk, cId) of _.chunk(item.image, 2)"><div class="col-6 p-2" :key="imgur" v-for="imgur of chunk"><button @click="btnSelect(imgur)" class="w-100 btn btn-img p-0" :class="{'selected': selected === imgur}"><div class="w-100 card-img" :style="{'background-image': `url('${imgur}')`}"></div><i :class="selected === imgur ? 'fa-check-circle-o' : 'fa-circle-o'" class="fa m-1 p-0"></i></button></div></div></div><div class="form-group m-0"><textarea :placeholder="item.share_input_text" class="form-control" v-model="text"></textarea></div></div></div><button @click="btnShare" class="btn btn-block btn-lg btn-success mt-3" :disabled="!selected || !text" type="button">{{item.share_button}}</button></template><div class="card" v-else><p class="text-center my-2">非活動期間</p></div></div><div class="align-items-center d-flex justify-content-center min-vh-100" v-else><h3 class="text-center">載入中請稍候…</h3></div></div><script src="https://static.line-scdn.net/liff/edge/2/sdk.js" crossorigin="anonymous"></script><script src="https://unpkg.com/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/dayjs/dayjs.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/js-base64@2/base64.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/qs@6/dist/qs.js" crossorigin="anonymous"></script><script src="https://unpkg.com/sweetalert2@11" crossorigin="anonymous"></script><script src="https://unpkg.com/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://unpkg.com/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://yuanchi17.github.io/mp-trending.github.io/js/common.js?cachebust=1643003620618"></script><script>window.errToPlainObj=(()=>{const e=["address","code","data","dest","errno","info","message","name","path","port","reason","response.data","response.headers","response.status","stack","status","statusCode","statusMessage","syscall"];return s=>_.pick(s,e)})();</script><script>const loginPromise=(async()=>{if(await liff.init({liffId:"1656762228-vABR1z2J"}),!liff.isLoggedIn())return liff.login({redirectUri:location.href}),new Promise(e=>{});let e={};try{e=await liff.getProfile(),gtag("set","user_id",e.userId)}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(window.errToPlainObj(e))}return e})(),IMAGE_MAX=8;window.vm=new Vue({el:"#app",data:{activity:"",item:{},msgs:null,page:"",selected:null,text:"",toggle:{}},async mounted(){this.showLoading("請稍候","正在載入網頁");try{var e=JSON.parse(localStorage.getItem(location.pathname));e&&this.$set(this,"h",{...this.h,...e})}catch(e){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON.stringify(this.h))},{deep:!0}),await this.init()},methods:{async init(){try{if(await loginPromise,this.activity=this.param("activity"),_.isNil(this.activity))throw new Error("小卡連結失效");await Promise.all([this.getData(),this.initGtag(),this.initTpl()]),this.page="init",this.hideLoading()}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(window.errToPlainObj(e)),await Swal.fire({icon:"error",title:"網頁讀取失敗",text:e.message}),location.reload()}},async getData(){var e=await window.getCsv("https://docs.google.com/spreadsheets/d/e/2PACX-1vT4l_mlqJfp_u1qNV0MNiwaGVIDpB6mgIhT0HlZwS_nUZtdq148QFGV-ROQhOeTwlour8bczwF-OO1M/pub?gid=0&single=true&output=csv");if(this.$set(this,"item",_.take(_.filter(e,["name",this.activity]))[0]),_.isNil(this.item))throw new Error("小卡連結失效");this.item.image=_.take(_.uniq(_.filter(_.map(_.get(this.item,"image","").split("\n"),_.trim))),IMAGE_MAX);var t=new Date,e=t>=new Date(this.item.end_time),t=t>=new Date(this.item.start_time);this.$set(this,"toggle",{ended:e,started:t,status:t&&!e})},async initGtag(){await loginPromise;var e=this.param("referral",null),t=this.activity;gtag("event","screen_view",{screen_name:`name=${t},module=小卡片,source=${this.param("source","未知")},`}),gtag("event","join_group",{group_id:t}),e&&gtag("event","campaign_referral",{campaign:t,line_id:e})},async initTpl(){const t=_.template(_.get(await axios.get("/tpl/card-modal.txt",{params:{cachebust:Date.now()},transformResponse:[]}),"data"));this.render=e=>t({_:_,dayjs:dayjs,Qs:Qs,...e})},async btnShare(){try{if(this.showLoading("請稍候","正在開啟分享畫面"),!liff.isApiAvailable("shareTargetPicker"))throw new Error("您的裝置不支援此功能，請嘗試重新開啟此頁面或更新應用程式版本。");var e=await loginPromise;const s=new URL(liff.permanentLink.createUrl());s.searchParams.set("referral",e.userId),s.searchParams.set("source","friend");var t=this.getRenderedMsgs({data:this.item,imgur:this.selected,profile:e,share:s.href,text:this.text}),i=Date.now(),a=await liff.shareTargetPicker(t);if(1e3<Date.now()-i&&"success"!==_.get(a,"status"))throw new Error("您已取消分享");gtag("event","share",{campaign:this.activity,content_type:this.selected,item_id:this.text.slice(0,100)}),await Swal.fire({icon:"success",title:"送出成功",text:this.item.success_text})}catch(e){e.message=_.get(e,"response.data.message",e.message),console.error(window.errToPlainObj(e)),await Swal.fire({icon:"error",title:"送出失敗",text:e.message})}},async btnSelect(e){(await Swal.fire({cancelButtonText:"關閉",confirmButtonText:"選擇",imageUrl:e,showCancelButton:!0,customClass:{header:"px-0",image:"my-0"}})).value&&this.$set(this,"selected",e)},getRenderedMsgs(e){let t=this.render(e);return console.log(t),t=JSON5.parse(t),_.includes(["bubble","carousel"],_.get(t,"type"))&&(t={type:"flex",altText:this.$t("flexAltText"),contents:t}),t=_.castArray(t),t},showLoading(e,t){Swal.fire({title:e,text:t,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})},hideLoading(){Swal.close()},param(e,t){e=new URL(location).searchParams.get(e);return _.isNil(e)?t:e}}});</script></body></html>